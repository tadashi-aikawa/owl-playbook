# Required powershell
version: "3"

tasks:
  default:
    - task: help

  help:
    silent: true
    cmds:
      - task -l

  hello:
    desc: 1日の開始に行う定型タスク
    cmds:
      - task: _pull:all

  backup:work:
    desc: 仕事用のバックアップ
    cmds:
      - cp ~/.ssh/* ~/backup/secrets/.ssh/
      - |
        cd ~ &&
        7z a -p backup.zip backup &&
        mv backup.zip G:\マイドライブ\

  backup:private:
    desc: プライベートのバックアップ
    cmds:
      - cmd: |
          cd ~/work &&
          7z a minerva.7z minerva &&
          explorer .
        ignore_error: true # なぜか必ずエラーになる..

  typescript:node:
    desc: |
      Node.js用のTypeScriptプロジェクトを作成する
          ∟ DST: プロジェクトを作成するパス (ex: DST=sample)
    cmds:
      - echo $(pwd)
      - npx degit tadashi-aikawa/typescript-base {{.DST}}
      - cd {{.DST}} && pwsh -File init.ps1 && code .
    preconditions:
      - sh: "[ {{.DST}} != '' ]"
        msg: "DST is required."

  ##### --private-- #####

  _pull:all:
    cmds:
      - task: _pull
        vars:
          REPO: spinal-reflex-bindings-template
      - task: _pull
        vars:
          REPO: owl-playbook

  _pull:
    dir: ~/git/github.com/tadashi-aikawa/{{.REPO}}
    cmds:
      - git status -s
      - "git log --graph --all --date=format:'%Y-%m-%d %H:%M' --pretty=format:'%C(auto)%d%Creset\ %C(yellow)%h%Creset %C(magenta)%ae%Creset %C(cyan)%ad%Creset%n%C(white bold)%w(80)%s%Creset%n%b' -3"
      - git pull
